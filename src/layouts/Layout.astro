---
// src/layouts/Layout.astro
import Header from '../components/Header.astro';
import '../styles/global.css';
import Footer from '../components/Footer.astro';
import FloatingCTA from '../components/FloatingCTA.astro';
import { ClientRouter } from 'astro:transitions';

const {
  title = 'WordPress Malware Removal Expert & Hacked Site Recovery - MD Pabel',
  description = 'Hacked WordPress site? I provide expert manual malware removal, Google blacklist fix, and security hardening. 4,500+ sites recovered. No monthly fees.',
  yoastHead = null,
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const cleanYoastHead = yoastHead
  ? yoastHead.replace(/<link rel="canonical".*?>/g, '')
  : null;
---

<!doctype html>
{/* Force 'dark' class and prevent any theme switching flash */}
<html
  lang='en'
  class='scroll-smooth dark'
  transition:animate='none'
  style='color-scheme: dark;'>
  <head>
    <meta charset='UTF-8' />
    <meta name='viewport' content='width=device-width' />
    <meta name='generator' content={Astro.generator} />
    <link rel='icon' type='image/png' href='/icon.png' />

    <link rel='sitemap' href='/sitemap.xml' />
    <link rel='sitemap' href='/threats-sitemap.xml' />
    <link
      rel='alternate'
      type='application/rss+xml'
      title='MD Pabel | WordPress Security Feed'
      href='/rss.xml'
    />

    {
      cleanYoastHead ? (
        <Fragment set:html={cleanYoastHead} />
      ) : (
        <>
          <title>{title}</title>
          <meta name='description' content={description} />
        </>
      )
    }

    <link rel='canonical' href={canonicalURL} />
    <ClientRouter />
  </head>

  {
    /* Locked to bg-slate-950 for a deeper forensic feel, text-slate-100 for readability */
  }
  <body
    class='flex flex-col bg-slate-950 selection:bg-sky-500/30 min-h-screen font-serif text-slate-100 selection:text-sky-200 antialiased'>
    <Header />

    <main class='grow'>
      <slot />
    </main>

    <Footer />
    <FloatingCTA />
  </body>
</html>

<script>
  // Ensure scroll bars and layout resets work correctly with View Transitions
  document.addEventListener('astro:page-load', () => {
    document.body.style.overflow = '';
  });
</script>

<style is:global>
  /* Forensic theme global overrides */
  :root {
    color-scheme: dark;
  }

  /* Force dark background on the HTML element to prevent white flashes during navigation */
  html {
    background-color: #020617; /* slate-950 */
  }

  /* Custom Scrollbar for the dark theme */
  ::-webkit-scrollbar {
    width: 10px;
  }
  ::-webkit-scrollbar-track {
    background: #0f172a; /* slate-900 */
  }
  ::-webkit-scrollbar-thumb {
    background: #1e293b; /* slate-800 */
    border-radius: 5px;
    border: 2px solid #0f172a;
  }
  ::-webkit-scrollbar-thumb:hover {
    background: #334155; /* slate-700 */
  }
</style>
