---
import ComponentWrapper from './component-wrapper.astro';

// 1. Get current path (Server Side)
const currentPath = Astro.url.pathname;
---

<div
  class='bg-slate-900 my-5 py-4 border border-slate-800 rounded-lg text-white'>
  <ComponentWrapper
    class='flex md:flex-row flex-col justify-between items-start md:items-center gap-4 md:gap-6'>
    {/* --- TEXT CONTENT --- */}
    <div>
      <h3 class='mb-1 font-bold text-xl'>WordPress Malware Removal</h3>
      <p class='flex flex-wrap items-baseline gap-1 text-slate-400 text-lg'>
        <span class='opacity-90'>
          Professional cleaning and security hardening for just
        </span>
        {/* Desktop Price */}
        <span
          class='hidden md:block drop-shadow-md ml-1 font-black text-yellow-300 text-3xl tracking-tight hover:scale-110 transition-transform duration-500 cursor-default transform'>
          $79
        </span>
      </p>
    </div>

    {/* --- CTA BUTTON --- */}
    <div class='flex items-center gap-8 w-full md:w-auto'>
      {/* Mobile Price */}
      <span
        class='md:hidden block drop-shadow-md ml-1 font-black text-yellow-300 text-3xl tracking-tight hover:scale-110 transition-transform duration-500 cursor-default transform'>
        $79
      </span>

      <a
        href='/hire-me'
        id='promo-banner-btn'
        data-location={currentPath}
        class='block bg-sky-600 hover:bg-sky-500 shadow-lg px-6 py-2 rounded-full w-full md:w-auto font-semibold text-white text-center transition-colors'>
        Get Started
      </a>
    </div>
  </ComponentWrapper>
</div>

<script>
  // 2. Client-Side GTM Event Handler
  const btn = document.getElementById('promo-banner-btn');

  if (btn) {
    btn.addEventListener('click', () => {
      const location = btn.getAttribute('data-location') || '';

      // Push to dataLayer (Standard GTM method)
      // @ts-ignore
      window.dataLayer = window.dataLayer || [];
      // @ts-ignore
      window.dataLayer.push({
        event: 'select_promotion',
        creative_name: 'malware_removal_banner_79',
        promotion_name: 'wordpress_security_promo',
        location: location,
        items: [
          {
            item_id: 'malware_removal_service',
            item_name: 'WordPress Malware Removal',
            price: 79,
          },
        ],
      });
    });
  }
</script>
