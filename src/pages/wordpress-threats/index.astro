---
import { getCollection, type CollectionEntry } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import ComponentWrapper from '../../components/component-wrapper.astro';

// Sort threats by date (Newest first)
const threats: CollectionEntry<'wordpress-threats'>[] = (
  await getCollection('wordpress-threats')
).sort(
  (a, b) =>
    new Date(b.data.reportDate).valueOf() -
    new Date(a.data.reportDate).valueOf(),
);
---

<Layout
  title='WordPress Security News & Threat Intelligence DB | MD Pabel'
  description='The latest WordPress security news today. A live database of active security vulnerabilities, zero-day malware, and bypass exploits detected in 2026.'>
  <ComponentWrapper class='py-14'>
    <div class='mx-auto mb-16 max-w-3xl text-center'>
      <h1 class='mb-4 font-extrabold text-white text-4xl'>
        WordPress Security <span class='text-blue-500'
          >& Threat Intelligence</span
        >
      </h1>
      <p class='text-slate-400 text-lg'>
        Your source for <strong>WordPress security news today</strong>. Browse
        our live archive of <span class='font-medium text-white'
          >active vulnerabilities</span
        >,
        <strong>bypass URL exploits</strong>, and zero-day malware signatures
        detected in the wild.
      </p>
    </div>

    <div class='gap-6 grid grid-cols-1 md:grid-cols-2'>
      {
        threats.map((threat) => {
          const { title, threatType, severity, reportDate, vtScore } =
            threat.data;
          const isFUD =
            vtScore?.includes('0/') || vtScore?.includes('Undetected');

          return (
            <a
              href={`/wordpress-threats/${threat.slug}`}
              class='group relative bg-slate-900 hover:shadow-xl p-6 border border-slate-800 rounded-xl transition-all hover:-translate-y-1 duration-300'>
              {/* Badges */}
              <div class='flex justify-between items-start mb-4'>
                <span
                  class={`px-2 py-1 rounded text-[10px] font-bold uppercase ${
                    severity === 'Critical'
                      ? 'bg-red-900/30 text-red-400 border border-red-800'
                      : 'bg-blue-900/30 text-blue-400 border border-blue-800'
                  }`}>
                  {severity}
                </span>

                {isFUD && (
                  <span class='bg-purple-900/30 px-2 py-1 border border-purple-800 rounded font-bold text-[10px] text-purple-400 uppercase animate-pulse'>
                    ðŸ‘» Undetected
                  </span>
                )}
              </div>

              <h3 class='mb-2 font-bold text-white group-hover:text-blue-400 text-xl transition-colors'>
                {title}
              </h3>

              <p class='mb-4 font-mono text-slate-500 text-sm'>
                Type: {threatType}
              </p>

              <div class='flex items-center gap-2 pt-4 border-slate-800 border-t text-slate-500 text-xs'>
                <span>ðŸ“… Detected: {reportDate}</span>
              </div>
            </a>
          );
        })
      }
    </div>
  </ComponentWrapper>
</Layout>
