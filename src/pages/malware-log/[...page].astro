---
import BlogPosts from '../../components/BlogPosts.astro'
import ComponentWrapper from '../../components/component-wrapper.astro'
import Layout from '../../layouts/Layout.astro'
import { wordpress } from '../../lib/wordpress'

// --- 1. Generate Static Paths ---
export async function getStaticPaths() {
  const PER_PAGE = 10;
  
  // Fetch metadata for 'malware-log' to calculate total required pages
  const { totalPages } = await wordpress.getPosts({
    postType: 'malware-log',
    perPage: PER_PAGE,
    page: 1,
  });

  // Create a static route for every page number found
  return Array.from({ length: totalPages }, (_, i) => {
    const pageNum = i + 1;
    return {
      // Page 1 matches the root '/malware-log' (param is undefined)
      // Page 2 matches '/malware-log/2', and so on.
      params: { page: pageNum === 1 ? undefined : pageNum.toString() },
    };
  });
}

// --- 2. Extract current page from Params ---
const { page } = Astro.params;
const currentPage = page ? Number(page) : 1;

// --- 3. Dynamic SEO Settings ---
const isFirstPage = currentPage === 1;
const baseUrl = "https://www.mdpabel.com/malware-log";

const seoTitle = isFirstPage 
  ? "Malware Logs: WordPress Security Analysis & Remediation" 
  : `Malware Logs - Page ${currentPage} | Security Insights`;

const seoDesc = "Detailed logs of malware discoveries, analyses, and remediations from client WordPress websites. Insights into common threats and cleanup strategies.";

// Canonical URL logic to prevent duplicate content indexing
const canonicalURL = isFirstPage ? baseUrl : `${baseUrl}/${currentPage}`;
---

<Layout 
  title={seoTitle} 
  description={seoDesc}
  image="/images/malware-log-opengraph-image.png"
  canonical={canonicalURL}
>
  <ComponentWrapper class="pt-12">
    <BlogPosts
      postType="malware-log"
      rootSlug="malware-log"
      page={currentPage}
      limit={10}
      title="Malware Logs: Analysis & Remediation Insights"
      shortDescription="In-depth analyses of malware infections, detection methods, and remediation strategies from real client sites."
      mode="all"
    />
  </ComponentWrapper>
</Layout>