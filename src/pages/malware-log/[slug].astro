---
import Layout from '../../layouts/Layout.astro';
import ComponentWrapper from '../../components/component-wrapper.astro';
import SinglePost from '../../components/SinglePost.astro';
import { wordpress } from '../../lib/wordpress';
import Banner from '../../components/Banner.astro'
import RelatedPosts from '../../components/RelatedPosts.astro'

export async function getStaticPaths() {
  // Fetch ALL malware logs
  const posts = await wordpress.getAllPosts({ postType: 'malware-log' }); 

  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;

// SEO
const seoTitle = `${post.title} | Malware Log`;
const seoDesc = post.excerpt.replace(/<[^>]*>?/gm, '').slice(0, 160);
const seoImage = post.featuredImage?.url;

// Schema
const schema = {
  "@context": "https://schema.org",
  "@type": "TechArticle", // Specific for technical logs
  "headline": post.title,
  "image": seoImage,
  "author": { "@type": "Person", "name": "MD Pabel" },
  "datePublished": post.date,
  "description": seoDesc
};
---

<Layout title={seoTitle} description={seoDesc} image={seoImage}>
  <script type="application/ld+json" set:html={JSON.stringify(schema)} is:inline />

   <Banner />
  
  <ComponentWrapper class="pb-20">
    {/* Passes "malware-log" so SinglePost renders the technical breakdown UI */}
    <SinglePost post={post} parentSlug="malware-log" />

     <RelatedPosts 
        currentPostId={post.id}
        categoryIds={post.categories.map(cat => cat.id)} 
      />
  </ComponentWrapper>
</Layout>