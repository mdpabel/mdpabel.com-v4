---
import BlogPosts from '../../components/BlogPosts.astro';
import ComponentWrapper from '../../components/component-wrapper.astro';
import Layout from '../../layouts/Layout.astro';
import { wordpress } from '../../lib/wordpress';

// --- 1. Generate Static Paths ---
export async function getStaticPaths() {
  const PER_PAGE = 10;

  // ðŸš€ FAST: Only fetches headers (1kb) instead of body (100kb+)
  const totalPages = await wordpress.getTotalPages({
    postType: 'posts',
    perPage: PER_PAGE,
  });

  return Array.from({ length: totalPages }, (_, i) => {
    const pageNum = i + 1;
    return {
      params: { page: pageNum === 1 ? undefined : pageNum.toString() },
    };
  });
}

// --- 2. Extract current page from Params ---
const { page } = Astro.params;
const currentPage = page ? Number(page) : 1;

// --- 3. Dynamic SEO Logic ---
const isFirstPage = currentPage === 1;
const baseUrl = 'https://www.mdpabel.com/blog';

// âœ… Fix 1: Dynamic Title (You already had this)
const seoTitle = isFirstPage
  ? 'WordPress Blog & Insights: Security, Malware Removal & Error Fixing'
  : `Blog Insights (Page ${currentPage}) | WordPress Security & Development`;

// âœ… Fix 2: Dynamic Description (Prevents "Duplicate Description" errors)
const seoDesc = isFirstPage
  ? 'Explore expert guides on WordPress security best practices, malware detection and removal, fixing common errors, and performance optimization.'
  : `Page ${currentPage} of the WordPress security archive. Browse articles on malware removal, site hardening, and development tutorials.`;

// âœ… Fix 3: Smart Canonical URL
const canonicalURL = isFirstPage ? baseUrl : `${baseUrl}/${currentPage}`;
---

<Layout
  title={seoTitle}
  description={seoDesc}
  image='/images/blog-opengraph-image.png'
  canonical={canonicalURL}>
  <ComponentWrapper class='pt-12'>
    <BlogPosts
      rootSlug='blog'
      page={currentPage}
      limit={10}
      title='Security, Malware Removal & Development Insights'
      shortDescription='Insights on WordPress security, malware removal, error fixing, and web development best practices.'
      mode='all'
    />
  </ComponentWrapper>
</Layout>
